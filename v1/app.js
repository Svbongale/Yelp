console.log("This is the yelpcamp V1");
// Import express package
var express=require("express");
var app=express();

// Body parser
var bodyparser= require("body-parser");
app.use(bodyparser.urlencoded({extended:true}));

// Connect mongoose to express
var mongoose=require("mongoose");

// connect mongoose
mongoose.connect("mongodb://localhost/Yelp_camp",{useNewUrlParser:true, useUnifiedTopology: true, useFindAndModify: false });

// Schema setup
var campgroundSchema = new mongoose.Schema({
	name: String,
	image: String
});

// Create Model
var Campground = mongoose.model("Campgrounds",campgroundSchema);
// Create a campground by default
Campground.create({
	name: "Seege Gudda",
	image: "data:image/jpeg;base64,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"
},function(err,Campground){
	if(err){
		console.log(err);
		console.log("Error...Could not add campground!");
	}else{
		console.log("Added the campground");
		console.log(Campground);
	}
});

// routes
app.get("/",function(req,res){
	
	res.render("landing.ejs");
});

// Campgrounds Route
app.get("/campgrounds",function(req,res){
	// Get all campgrounds from the database
	Campground.find({},function(err,allCampground){
		if(err){
			console.log(err);
			console.log("Somthing went wrong");
		}else{
			console.log("Campgrounds are:");
			res.render("campgrounds.ejs",{campgrounds:allCampground});
		}
	});
	 
});

// add new campgrounds
app.get("/campgrounds/new",function(req,res){
	res.render("new.ejs");
});

// Post  routes
app.post("/campgrounds",function(req,res){
// 	get data from the form and add it to the campgrounds array
	
	var name=req.body.name;
	var image=req.body.image;
	var newCampGround={name:name,image:image};
	// save it to the database
	Campground.create(newCampGround,function(err,newlyCreated){
		if(err){
			console.log(err);
		}else{
			// rediect to the same page by updating the data
			res.redirect("/campgrounds");
		}
	})
});

// App listner
app.listen(4000, function() { 
console.log("yelpcamp server has started");	
console.log('Server listening on port 3000'); 
});